# ADKernels System

An "ADKernel" is a piece of physics. It can represent one or more operators or terms in the weak form of
a partial differential equation.  With all terms on the left-hand-side, their sum is referred to as
the "residual". The residual is evaluated at several integration quadrature points over the problem
domain. To implement your own physics in MOOSE, you create your own kernel by subclassing the MOOSE
`ADKernel` class.

In an `ADKernel` subclass the `computeQpResidual()` function +must+ be overridden.  This is where you
implement your PDE weak form terms. By using an `ADKernel` as opposed to an
ordinary [`Kernel`](syntax/Kernels/index.md), you are automatically computing the
Jacobian, so you do not have to worry about hand-coding a Jacobian, which is
prone to error.

Inside your ADKernel class, you have access to several member variables for computing the
residual and Jacobian values in the above mentioned functions:

- `_i`: indices for the current test shape functions.
- `_qp`: current quadrature point index.
- `_u`, `_grad_u`: value and gradient of the variable this ADKernel operates on;
  indexed by `_qp` (i.e. `_u[_qp]`).
- `_test`, `_grad_test`: value ($\psi$) and gradient ($\nabla \psi$) of the
  test functions at the q-points; indexed by `_i` and then `_qp` (i.e., `_test[_i][_qp]`).
- `_q_point`: XYZ coordinates of the current quadrature point.
- `_current_elem`: pointer to the current element being operated on.

## Custom ADKernel Creation

To create a custom kernel, you can follow the pattern of the [`ADDiffusion`](/ADDiffusion.md) kernel
implemented and included in the MOOSE framework.

The strong-form of the diffusion equations is defined on a 3-D domain $\Omega$ as: find $u$ such
that

\begin{equation}
\label{strong-form}
\begin{aligned}
-\nabla\cdot\nabla u - f &= 0 \in \Omega\\
u|_{\partial\Omega_1} &= g_1\\
\nabla u\cdot \hat{n} |_{\partial\Omega_2} &= g_2,
\end{aligned}
\end{equation}
where $\partial\Omega_1$ is defined as the boundary on which the value of $u$ is fixed to a known
constant $g_1$, $\partial\Omega_2$ is defined as the boundary on which the flux across the boundary
is fixed to a known constant $g_2$, and $\hat{n} is the boundary outward normal.

The weak form is generated by multiplying by a test function ($\psi_i$) and integrating over the
domain (using inner-product notation):

\begin{equation}
(-\nabla\cdot\nabla u_h, \psi_i) - (f, \psi_i) = 0\quad \forall\,\psi_i
\end{equation}

and then integrating by parts which gives the weak form:

\begin{equation}
\label{weak-form}
(\nabla u_h, \nabla \psi_i) - (f, \psi_i) - \langle g_2, \psi_i\rangle = 0\quad \forall\,\psi_i,
\end{equation}
where $u_h$ is known as the trial function that defines the finite element discretization, $u
\approx u_h = \sum_{j=1}^N u_j \phi_j$, with $\phi_j$ being the basis functions.

The diffusion kernel header and implementation files are:

!listing framework/include/kernels/ADDiffusion.h max-height=400px

!listing framework/src/kernels/ADDiffusion.C max-height=400px
