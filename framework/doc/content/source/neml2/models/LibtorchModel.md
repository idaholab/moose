# LibtorchModel

!if! function=hasCapability('neml2')

!alert note
This is a NEML2 model. See the [NEML2 syntax documentation](syntax/NEML2/index.md) for guidance on using NEML2 models in a MOOSE simulation.

This model is a wrapper for evaluating PyTorch modules in `.pt` format, mapping an arbitrary number of inputs to an arbitrary number of outputs. See the [Torch Script](https://docs.pytorch.org/docs/stable/jit.html) documentation for instructions on exporting PyTorch modules as torch scripts.

## Example Input File

An example NEML2 input file is shown below. In this example, a single input `inputs = 'forces/T'` is mapped to a single output `outputs = 'state/k_T'`.

!listing test/tests/neml2/torchscript/thermal_conductivity.i block=Models/kappa

The evaluated NEML2 variable value `state/k_T` can then be mapped back to a MOOSE material property as shown in the following input file.

!listing test/tests/neml2/torchscript/heat_conduction.i block=NEML2

The NEML2 input file is specified inside the `NEML2` block. We specify which NEML2 model to use (`model = 'rom'`), and specify that we want to map the non-linear `T` variable in MOOSE to the `forces/T` NEML2 variable, and the `state/k_T` NEML2 variable is mapped back to the `k_T` MOOSE material property (which is automatically generated by the action).

NEML2 also uses automatic differenciation on the libtorch model to provide arbitrary derivatives of the outputs in relation to the inputs. Here we specify that we want to calculate $\frac{dk_T}{dT}$ to populate the Jacobian in a heat conduction example problem.

!bibtex bibliography

!if-end!

!else

!include neml2/neml2_warning.md
