# Advanced Meshing Examples

!---

## Possible Advanced Reactor Geometries

This tutorial covers the generation of mostly standard geometries, but many reactor designs involve features which were not covered previously. Using the tools covered in this section, MOOSE can generate quite complex geometries illustrated here. The key mesh generators required are listed briefly.

!---

### Molten Salt Reactor Experiment (MSRE) 2D lattice

!row!
!col! width=50%

- [PolygonConcentricCircleMeshGenerator.md] is utilized for producing circular and triangular-shaped regions within the lattice
- [FillBetweenSidesetsGenerator.md] is employed for generating mesh to fill in the regions between the regions generated by [PolygonConcentricCircleMeshGenerator.md]

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_2DMSRE.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

### KRUSTY heat-pipe cooled microreactor 2D core

!row!
!col! width=50%

- [ParsedCurveGenerator.md] is used for creating the outline of complex shapes before mesh generation.
- [XYDelaunayGenerator.md] is employed for meshing the irregular areas.
- [PeripheralTriangleMeshGenerator.md] is utilized to add layers of triangular mesh onto an existing circular mesh.
- [CircularBoundaryCorrectionGenerator.md] is used to adjust a discretized circle to match the true circle's volume.

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_2DKRUSTY.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

### Modular High Temperature Gas Cooled Reactor (MHTGR)

- [PolygonConcentricCircleMeshGenerator.md] and [PatternedHexMeshGenerator.md] generate pins and assemblies
- [XYDelaunayGenerator.md] generates control rod holes and reflector assemblies
- [StitchedMeshGenerator.md] merges control rod holes with fuel and reflector assemblies
- [HexagonConcentricCircleAdaptiveBoundaryMeshGenerator.md] generates ducts for reflector assembly that can be stitched with other assembles.
- [PatternedHexMeshGenerator.md] generates a lattice of fuel and reflector assemblies into the core
- [PeripheralRingMeshGenerator.md] adds a circular boundary surrounding the core
- [AdvancedExtruderGenerator.md] performs 2D to 3D extrusion for the core
- [DepletionIDGenerator.md] sets up assembly-wise depletion zones

!row!
!col! width=50%

!media tutorial04_meshing/adv_ex_mhgtr.png
       style=width:50%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_mhtgrzoom.png
       style=width:70%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

### 2D Pebble Bed Reactor with Streamlines

!row!
!col! width=66%

- [FillBetweenPointVectorsGenerator.md] generates pebble bed streamlines
- [CartesianMeshGenerator.md] and [FillBetweenSidesetsGenerator.md] generates rectangular meshes and trapezoid meshes
- [StitchedMeshGenerator.md] merges core components
- [CombinerGenerator.md] combines outer walls of core barrel and RPV

!col-end!

!col! width=33%

!media tutorial04_meshing/adv_ex_PBRPronghornGriffin.png
       style=width:60%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Boundary Layers and Biasing

During the mesh refinement process, it is common to require finer discretizations in one region and coarser discretizations in another region. The boundary layer and biasing features available in the Reactor Module allow the user to refine the mesh in areas of interest for the physics problem at hand.

!---

### Mesh Biasing

Mesh biasing applies non-uniform meshing subintervals within a specific region. For example, a fuel pin may generally require an axial meshing size of 5 cm, but at the very top and bottom of the active fuel zone where the power shape has a larger gradient, the user may require finer grids. This is possible using mesh biasing parameters available in [AdvancedExtruderGenerator.md].

!row!
!col! width=50%

!listing adv_examples/ax_bias.i
         block=Mesh
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/aeg_ax_bias.png
       style=width:40%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

### Radial Mesh Biasing

Similarly, the user may want to radially bias the mesh where solution gradients are known to be high, for example at the edge of a fuel pin or control rod. This is possible using mesh biasing parameters in [PolygonConcentricCircleMeshGenerator.md] as well as [PeripheralRingMeshGenerator.md].

!row!
!col! width=50%

!listing adv_examples/rad_bias_pccmg.i
         block=Mesh
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/pccmg_rad_bias.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

### Radial Mesh Biasing in Core Periphery

!row!
!col! width=50%

!listing adv_examples/rad_bias_prmg.i
         block=Mesh
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/prmg_rad_bias.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

### Mesh Boundary Layers

Boundary layers are commonly needed in thermal-hydraulic applications, where the thickness of the mesh near a wall must be a certain size, uniformly, regardless of the width of the meshed region. Boundary layers are possible using [PolygonConcentricCircleMeshGenerator.md] and [PeripheralRingMeshGenerator.md].

!row!
!col! width=50%

!listing adv_examples/bdry_layer_pccmg.i
         block=Mesh
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/pccmg_bdry_layer.png
       style=width:80%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Stitching Assemblies with Different Pin Numbers

Typical reactor cores are comprised of many different assembly types, each with different numbers of pins. It is difficult to find a reasonably low azimuthal discretization for each assembly such that all assemblies have the same number of nodes on their boundaries.

The best approach for this situation is to use [PatternedHexPeripheralModifier.md] to strip the outermost layer off each assembly and replace it with a transition layer with a set number of nodes on the outermost boundary.

!row!
!col! width=50%

!listing modules/reactor/test/tests/meshgenerators/patterned_hex_peripheral_modifier/patterned.i
         block=Mesh
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_assembies_with_different_pin_nums.png
       style=width:80%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Oversized Pin

Some assemblies contain one or multiple oversized pins which intrude on neighboring unit pin cells. Meshing of such oversized pins has become straightforward with [FlexiblePatternGenerator.md]

As long as pins are not overlapped, [FlexiblePatternGenerator.md] can handle any oversized pin scenarios.

!row!
!col! width=50%

!listing adv_examples/oversize.i
         block=Mesh
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_oversized_pin.png
       style=width:70%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Filling Between Curves using "FillBetweenSidesetsGenerator"

The MSRE 2D lattice case was constructed using the [FillBetweenSidesetsGenerator.md] to connect "quarter" circular pins. First, [ConcentricCircleMeshGenerator.md] (a predecessor of [PolygonConcentricCircleMeshGenerator.md] which has a different set of input options and works only for square pin cells) was used to create two quarter pins.

!row!
!col! width=33%

!listing adv_examples/quarter_circle_connect.i
         block=Mesh/connect_two_circles
         link=False

!col-end!

!col! width=66%

!media tutorial04_meshing/adv_ex_fbsg.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Triangulation of Odd-Shaped Regions Using "ParsedCurveGenerator" and "XYDelaunayGenerator"

This example demonstrates how to place a control drum object in an arbitrary position in a core that may overlap subdomain boundaries.

First, the center assembly is created using regular pins and procedures.

!row!
!col! width=50%

!listing adv_examples/pcg_xyd.i
         block=Mesh/hex_1 Mesh/pattern
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_pcg_xy_patterned_pins.png
       style=width:80%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Triangulation of Odd-Shaped Regions (cont.)

Next, two circular peripheral regions are added using [PeripheralTriangleMeshGenerator.md] (yellow, purple zones).

!row!
!col! width=50%

!listing adv_examples/pcg_xyd.i
         block=Mesh/tmg1 Mesh/tmg2
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_pcg_xy_patterned_pins_with_rings.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Triangulation of Odd-Shaped Regions (cont.)

Next, the complex boundary shape which is the outer edge of the light blue zone is defined using [ParsedCurveGenerator.md] and analytic piecewise functions. The interior of this boundary is then filled in, including the center assembly, using [XYDelaunayGenerator.md].

!row!
!col! width=50%

!listing adv_examples/pcg_xyd.i
         block=Mesh/pcg1 Mesh/xydg1
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_pcg_xy_patterned_pins_with_irregular_peripheral_region.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Triangulation of Odd-Shaped Regions (cont.)

The control drum object is defined including the absorber arc using [PolygonConcentricCircleMeshGenerator.md] and [AzimuthalBlockSplitGenerator.md], then the background region of the control drum is deleted to leave only the circular part. This mesh is then translated into the desired position of the final mesh using [TransformGenerator.md]. The small red pin is defined similarly (not requiring [AzimuthalBlockSplitGenerator.md]).

!row!
!col! width=50%

!listing adv_examples/pcg_xyd.i
         block=Mesh/cd Mesh/cd_azi_define Mesh/cd_bd Mesh/cd_translate Mesh/outer_pin Mesh/op_bd Mesh/op_translate
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_pcg_xy_three_holes_for_xyd.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Triangulation of Odd-Shaped Regions (cont.)

The outer boundary of the dark blue zone is then generated using [ParsedCurveGenerator.md] and analytical functions. [XYDelaunayGenerator.md] is again used to fill the dark blue regions, keeping the light blue region and assembly, control drum, and small pin.

!row!
!col! width=50%

!listing adv_examples/pcg_xyd.i
         block=Mesh/pcg2 Mesh/xydg2
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_pcg_xy_second_xyd.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!

!---

## Triangulation of Odd-Shaped Regions (cont.)

Finally, a circular peripheral region is added at the end using [PeripheralTriangleMeshGenerator.md] (yellow).

!row!
!col! width=50%

!listing adv_examples/pcg_xyd.i
         block=Mesh/tmg3
         link=False

!col-end!

!col! width=50%

!media tutorial04_meshing/adv_ex_pcg_and_xyd.png
       style=width:100%;display:block;margin-left:auto;margin-right:auto;

!col-end!

!row-end!
