[Tests]
  [./test]
    type = 'Exodiff'
    input = 'simple_transient_diffusion.i'
    exodiff = 'simple_transient_diffusion_out.e'
    scale_refine = 3
    issues = '#000'
    design = 'TimeDerivative.md'
    requirement = 'MOOSE shall be able to run a transient diffusion problem'
  [../]
  [cant-solve-poorly-scaled]
    type = RunException
    input = 'ill_conditioned_simple_diffusion.i'
    expect_err = 'Solve failed and timestep already at or below dtmin'
    expect_out = '1 of 3 singular values'
    issues = '#12601'
    design = 'FEProblemSolve.md'
    requirement = 'We shall not be able to solve a problem where the physics Jacobians are very large compared to the jacobian from a Dirichlet BC (unity)'
    cli_args = 'Outputs/exodus=false'
    max_parallel = 1 # no parallel svd preconditioner
  []
  [automatic-scaling-done-once]
    type = Exodiff
    input = 'ill_conditioned_simple_diffusion.i'
    exodiff = 'ill_conditioned_simple_diffusion_out.e'
    absent_out = '1 of 3 singular values'
    issues = '#12601'
    design = 'FEProblemSolve.md'
    requirement = "We shall be able to solve an initially poorly scaled problem by using MOOSE's automatic scaling feature"
    cli_args = 'Executioner/automatic_scaling=true'
    max_parallel = 1 # no parallel svd preconditioner
  []
  [automatic-scaling-done-once-parallel-preconditioner]
    type = Exodiff
    input = 'ill_conditioned_simple_diffusion.i'
    exodiff = 'ill_conditioned_simple_diffusion_out.e'
    issues = '#12601'
    design = 'FEProblemSolve.md'
    requirement = "We shall be able to solve an initially poorly scaled problem by using MOOSE's automatic scaling feature in parallel"
    cli_args = 'Executioner/automatic_scaling=true -pc_type hypre -pc_hypre_type boomeramg'
    prereq = 'automatic-scaling-done-once'
    max_parallel = 2 # Can't reset preallocation in PETSc when there are no dofs on a process
  []
  [cant-solve-large-transient-changes]
    type = RunException
    input = 'ill_conditioned_simple_diffusion.i'
    expect_err = 'Solve failed and timestep already at or below dtmin'
    expect_out = '1 of 3 singular values'
    issues = '#12601'
    design = 'FEProblemSolve.md'
    requirement = 'We shall not be able to solve a problem where the physics has large changes over time if we only scale once'
    cli_args = "Executioner/automatic_scaling=true Materials/active='function' Executioner/num_steps=10 BCs/right/function='ramp' Outputs/exodus=false"
    max_parallel = 1 # no parallel svd preconditioner
  []
  [automatic-scaling-done-per-time-step]
    type = Exodiff
    input = 'ill_conditioned_simple_diffusion.i'
    exodiff = 'transient.e'
    absent_out = '1 of 3 singular values'
    issues = '#12601'
    design = 'FEProblemSolve.md'
    requirement = 'We shall be able to solve a problem where the physics has large changes over time if we scale on every time step'
    cli_args = "Executioner/automatic_scaling=true Executioner/compute_scaling_once=false Materials/active='function' Executioner/num_steps=10 BCs/right/function='ramp' Outputs/file_base=transient"
    max_parallel = 1 # no parallel svd preconditioner
  []
  [automatic-scaling-done-per-time-step-parallel-preconditioner]
    type = Exodiff
    input = 'ill_conditioned_simple_diffusion.i'
    exodiff = 'transient.e'
    absent_out = '1 of 3 singular values'
    issues = '#12601'
    design = 'FEProblemSolve.md'
    requirement = 'We shall be able to solve a problem where the physics has large changes over time if we scale on every time step in parallel'
    cli_args = "Executioner/automatic_scaling=true Executioner/compute_scaling_once=false Materials/active='function' Executioner/num_steps=10 BCs/right/function='ramp' Outputs/file_base=transient -pc_type hypre -pc_hypre_type boomeramg"
    prereq = 'automatic-scaling-done-per-time-step'
    max_parallel = 2 # Can't reset preallocation in PETSc when there are no dofs on a process
  []
  [auto-scaling-cant-have-zero-local-dofs]
    type = RunException
    input = ill_conditioned_simple_diffusion.i
    cli_args = "Executioner/automatic_scaling=true Outputs/exodus=false"
    min_parallel = 3
    issues = '#12601'
    requirement = 'We shall error out when trying to do automatic scaling and we have any process with zero dofs'
    design = 'FEProblemSolve.md'
    expect_err = "MOOSE doesn't currently support automatic scaling when there are any processes owning zero dofs"
  []
[]
