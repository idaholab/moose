[Tests]
  issues = '#26470 #32293'
  design = Capabilities.md
  [not_supported_registered]
    type = RunException
    input = input.i
    cli_args = '--required-capabilities test_false'
    expect_err = 'Required capabilities \'test_false\' not fulfilled\.'
    expect_exit_code = 77
    requirement = 'The system shall not start a simulation if a requested capability is registered as false.'
  []
  [negative_not_supported_registered]
    type = RunApp
    input = input.i
    cli_args = '--required-capabilities !test_false'
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall start a simulation if a capability requested to not be present is registered as false.'
  []
  [false_compare_registered]
    type = RunException
    input = input.i
    cli_args = "--required-capabilities 'test_one & test_one>1'"
    expect_err = 'Required capabilities \'test_one & test_one>1\' not fulfilled\.'
    expect_exit_code = 77
    requirement = 'The system shall not start a simulation if a requested capability is not registered.'
  []
  [negative_false_compare_registered]
    type = RunApp
    input = input.i
    cli_args = "--required-capabilities '!(test_one & test_one>1)'"
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall start a simulation if a capability in a negate comparison is not registered.'
  []
  [not_supported_not_registered]
    type = RunException
    input = input.i
    cli_args = '--required-capabilities doesnotexist'
    expect_err = 'Required capabilities \'doesnotexist\' not fulfilled\.'
    expect_exit_code = 77
    requirement = 'The system shall not start a simulation if a requested capability is not supported.'
  []
  [negative_not_supported_not_registered]
    type = RunApp
    input = input.i
    cli_args = '--required-capabilities !doesnotexist'
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall start a simulation if a capability requested to not be present is not registered.'
  []
  [not_absent]
    type = RunException
    input = input.i
    cli_args = '--required-capabilities !test_version'
    expect_err = 'Required capabilities \'!test_version\' not fulfilled\.'
    expect_exit_code = 77
    requirement = 'The system shall not start a simulation if an excluded capability is supported.'
  []
  [supported]
    type = RunApp
    input = input.i
    cli_args = '--required-capabilities \'!test_false & test_one & test_one=1 & test_two_explicit=2 & test_string & test_string=string & test_string_explicit=string & test_string_enum & test_string_enum=string\''
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall start a simulation if requested capabilities are supported.'
  []
  [version_mismatch]
    type = RunException
    input = input.i
    cli_args = "--required-capabilities test_version<1.0.3"
    expect_err = 'Required capabilities \'test_version<1.0.3\' not fulfilled\.'
    expect_exit_code = 77
    requirement = 'The system shall not start a simulation if a requested capability has the wrong version.'
  []
  [negative_version_mismatch]
    type = RunApp
    input = input.i
    cli_args = "--required-capabilities !(test_version<1.0.3)"
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall start a simulation if a requested capability does not have the wrong version.'
  []
  [negative_nonexisting_comparison]
    type = RunException
    input = input.i
    cli_args = "--required-capabilities !(doesnotexist<1.0.3)"
    expect_err = 'Required capabilities \'!\(doesnotexist<1.0.3\)\' are not specific enough\.'
    requirement = 'The system shall start a simulation if a negated test involves a capability that is not registered.'
  []
  [int_explicit_bool]
    type = RunException
    input = input.i
    cli_args = '--required-capabilities test_two_explicit'
    expect_err = "Capability statement 'test_two_explicit': capability 'test_two_explicit' requires a value and cannot be used in a boolean expression"
    requirement = 'The system shall report an error if using an explicit integer capability in a boolean statement'
  []
  [string_explicit_bool]
    type = RunException
    input = input.i
    cli_args = '--required-capabilities test_string_explicit'
    expect_err = "Capability statement 'test_string_explicit': capability 'test_string_explicit' requires a value and cannot be used in a boolean expression"
    requirement = 'The system shall report an error if using an explicit string capability in a boolean statement'
  []
  [string_enum]
    type = RunException
    input = input.i
    cli_args = '--required-capabilities=\'test_string_enum=bar\''
    expect_err = "Capability statement 'test_string_enum=bar': 'bar' invalid for capability 'test_string_enum'; valid values: foo, string"
    requirement = 'The system shall report an error if using an enumerated capability with a non-enumerated value'
  []
  [installation_type]
    type = RunApp
    input = input.i
    cli_args = '--required-capabilities=\'installation_type!=unknown\''
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall store as a capability the installation type, either in tree or relocated'
  []
  [compiler]
    type = RunApp
    input = input.i
    cli_args = '--required-capabilities=\'compiler!=unknown\''
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall store as a capability the compiler'
  []
  [platform]
    type = RunApp
    input = input.i
    cli_args = '--required-capabilities=\'platform!=unknown\''
    expect_out = 'Solve Skipped!'
    requirement = 'The system shall store as a capability the platform'
  []
[]
